# 編集画面タブUI分割 設計書

## 目的

編集画面のフォームを「基本情報」「アイテム」の2つのタブで切り替え可能にし、情報量の多い編集画面をセクション別に整理してUXを改善する。

## 対象範囲

- **対象**: 編集画面のみ（`isEdit=true`の場合）
- **対象外**: 新規作成画面（現状維持）

## 画面構成

### タブ構造

```
┌─────────────────────────────────────┐
│ ヘッダー（編集画面用）               │
├─────────────────────────────────────┤
│ [基本情報] [アイテム]  ← タブナビ    │
├─────────────────────────────────────┤
│                                     │
│  選択中タブのコンテンツ               │
│                                     │
└─────────────────────────────────────┘
```

### タブ定義

| タブ名 | 内容 | 初期表示 |
|--------|------|----------|
| 基本情報 | チェックリスト名、説明、現場名、作業日、テンプレートフラグ | ○（デフォルト） |
| アイテム | カテゴリー選択、アイテム入力、追加済みアイテムリスト | - |

### 切替挙動

- タブクリックで即時切り替え（ページ遷移なし）
- タブ切替時にフォーム入力値は保持される（状態リセットしない）
- バリデーションエラーは該当タブ内で表示
- 保存ボタンはヘッダーに配置（現状維持）→ どのタブからでも保存可能

## 状態管理方針

### タブ状態

- `ChecklistForm`コンポーネント内で`useState`で管理
- 型: `'basic' | 'items'`
- デフォルト値: `'basic'`
- 編集画面（`isEdit=true`）のみタブ表示

```typescript
type TabType = 'basic' | 'items';
const [activeTab, setActiveTab] = useState<TabType>('basic');
```

### フォーム状態

- 既存の`react-hook-form`の`FormProvider`をそのまま活用
- タブ切り替えで状態はリセットしない
- 各タブのフィールドは引き続き同一フォームコンテキストで管理

### アイテム状態

- 既存の`items`, `newItem`, `selectedCategoryId`などの状態は変更なし
- タブ切り替えで入力中のアイテム情報も保持

## 影響範囲

### 変更対象ファイル

| ファイル | 変更内容 |
|----------|----------|
| `src/components/form/ChecklistForm.tsx` | タブUI追加、コンテンツをタブ別にラップ |

### 変更しないファイル

| ファイル | 理由 |
|----------|------|
| `src/app/checklists/[id]/edit/page.tsx` | ロジックは変更不要、propsも変更なし |
| `src/app/checklists/new/page.tsx` | 新規作成画面は対象外 |

## 既存ロジックへの影響

- **保存処理 (onSubmit)**: 変更なし。両タブの入力値は同一フォームで管理されるため、既存の送信処理がそのまま動作
- **バリデーション**: 変更なし。react-hook-formのバリデーションはタブに関係なく動作
- **アイテム追加/削除**: 変更なし。「アイテム」タブ内で既存ロジックがそのまま動作
- **API呼び出し**: 変更なし

## 実装フロー

### フェーズ1: UIタブ構造の追加

1. タブ状態の`useState`を追加
2. タブナビゲーションUIを追加（編集画面のみ表示）
3. 既存の「基本情報」「アイテム追加」セクションをタブ切り替えで出し分け

### フェーズ2: セクション分割と導線調整

1. タブのアクティブ状態に応じたスタイル適用
2. タブ切り替え時の動作確認
3. 新規作成画面が影響を受けていないことを確認

### フェーズ3: リファクタ・微調整・最終確認

1. コードの整理
2. アクセシビリティ対応（aria属性など）
3. 全体動作確認

## UIデザイン方針

- 既存のTailwindスタイルと統一
- タブはヘッダー直下に配置
- アクティブタブは青色(`blue-600`)でハイライト
- 非アクティブタブはグレー系で控えめに表示
- タブ間の切り替えはスムーズに（アニメーションは控えめ）

## タブUIコンポーネント案

```tsx
{/* タブナビゲーション（編集画面のみ） */}
{isEdit && (
  <div className="bg-white border-b">
    <nav className="flex">
      <button
        type="button"
        onClick={() => setActiveTab('basic')}
        className={`px-4 py-3 text-sm font-medium ${
          activeTab === 'basic'
            ? 'border-b-2 border-blue-600 text-blue-600'
            : 'text-gray-500 hover:text-gray-700'
        }`}
      >
        基本情報
      </button>
      <button
        type="button"
        onClick={() => setActiveTab('items')}
        className={`px-4 py-3 text-sm font-medium ${
          activeTab === 'items'
            ? 'border-b-2 border-blue-600 text-blue-600'
            : 'text-gray-500 hover:text-gray-700'
        }`}
      >
        アイテム
      </button>
    </nav>
  </div>
)}
```

## 確認事項

- [x] 編集画面でタブが正しく表示される
- [x] タブ切り替えで入力値が保持される
- [x] 保存ボタンが両タブから動作する
- [x] 新規作成画面は従来通り（タブなし）
- [x] 既存のバリデーションが正常動作する
- [x] アイテムの追加・削除が正常動作する
- [x] バリデーションエラー時に該当タブへ自動切り替え
- [x] タブにエラーインジケーター（赤ドット）表示

## 実装完了（2026-01-05）

### 変更サマリ

| 項目 | 内容 |
|------|------|
| 変更ファイル | `src/components/form/ChecklistForm.tsx` |
| 追加行数 | 約40行 |
| lint | pass（既存警告のみ） |
| build | pass |

### 追加機能

1. **タブUI**: 編集画面のみ「基本情報」「アイテム」タブを表示
2. **タブ切替**: `useState`でタブ状態管理、クリックで即時切替
3. **エラー時自動切替**: `handleSubmit`の`onError`で基本情報タブへ自動遷移
4. **エラーインジケーター**: 基本情報タブにエラーがある場合、赤いドットを表示
